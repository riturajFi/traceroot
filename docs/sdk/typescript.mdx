# TypeScript SDK for TraceRoot

## Introduction
This SDK is a lightweight wrapper around OpenTelemetry, optimized for ease of use.

## Installation
```bash
npm install traceroot-sdk-ts@latest
```

## Environment Setup
### Basics
Create an [TraceRoot token](https://test.traceroot.ai/integrate) from the dashboard, and add it to your `traceroot.config.ts` file in the root of your project.

```typescript
import type { TraceRootConfigFile } from 'traceroot-sdk-ts/src/config';

const config: TraceRootConfigFile = {
  // The token for the TraceRoot API
  token=traceroot-430246,

  // The name of the service you are tracing.
  service_name: 'ts-example',

  // The owner of the GitHub repository
  github_owner: github_owner,

  // The name of the GitHub repository
  github_repo_name: github_repo_name,

  // The commit hash of the GitHub repository
  github_commit_hash: 'main',

  // Enable cloud export of spans (default: `true`)
  enable_span_cloud_export: true,

  // Enable cloud export of logs (default: `true`)
  enable_log_console_export: true,

  // Enable console export of spans (default: `false`)
  enable_span_console_export: false,

  // Enable console export of logs (default: `true`)
  enable_log_console_export: true,

  // The environment configuration such as development, staging, production
  environment: 'development',

  // Whether to store all telemetry data locally.
  local_mode: false,
};
export default config;
```

For JavaScript config,

```javascript
const config = {
  // The token for the TraceRoot API
  token=traceroot-430246,

  // The name of the service you are tracing.
  service_name: 'js-example',

  // The owner of the GitHub repository
  github_owner: github_owner,

  // The name of the GitHub repository
  github_repo_name: github_repo_name,

  // The commit hash of the GitHub repository
  github_commit_hash: 'main',

  // Enable cloud export of spans (default: `true`)
  enable_span_cloud_export: true,

  // Enable cloud export of logs (default: `true`)
  enable_log_console_export: true,

  // Enable console export of spans (default: `false`)
  enable_span_console_export: false,

  // Enable console export of logs (default: `true`)
  enable_log_console_export: true,

  // The environment configuration such as development, staging, production
  environment: 'development',

  // Whether to store all telemetry data locally.
  local_mode: false,
};

module.exports = config;
```

### Indicate the Location of the Config File

You could set the `TRACEROOT_CONFIG_PATH` environment variable to indicate the location of the config file if necessary.

```bash
export TRACEROOT_CONFIG_PATH=/path/to/your/traceroot.config.ts
```

## Examples

### TypeScript Example
```typescript
import * as traceroot from 'traceroot-sdk-ts';

const logger = traceroot.get_logger();

async function main() {
  const greet = traceroot.traceFunction(
    async function greet(name: string): Promise<string> {
      logger.info(`Greeting inside traced function: ${name}`);
      // Simulate some async work
      await new Promise(resolve => setTimeout(resolve, 100));
      return `Hello, ${name}!`;
    },
    { spanName: 'greet' }
  );

  const result = await greet('world');
  logger.info(`Greeting result: ${result}`);
}

main().then(async () => {
  await traceroot.forceFlushTracer();
  await traceroot.shutdownTracing();
  await traceroot.forceFlushLogger();
  await traceroot.shutdownLogger();
  process.exit(0);
});
```

### JavaScript Example

```typescript
import * as traceroot from 'traceroot-sdk-ts';

const logger = traceroot.get_logger();

class GreetingService {
  // @ts-ignore - TypeScript has strict typing issues with decorators, but this works at runtime
  @traceroot.trace({ spanName: 'greet' })
  async greet(name: string): Promise<string> {
    logger.info(`Greeting inside traced function: ${name}`);
    // Simulate some async work
    await new Promise(resolve => setTimeout(resolve, 1000));
    return `Hello, ${name}!`;
  }
}

async function main() {
  const service = new GreetingService();
  const result = await service.greet('world');
  logger.info(`Greeting result: ${result}`); // This will not be shown in TraceRoot UI
}

main().then(async () => {
  await traceroot.forceFlushTracer();
  await traceroot.shutdownTracing();
  await traceroot.forceFlushLogger();
  await traceroot.shutdownLogger();
  process.exit(0);
});
```

## Development Installation
If you want to contribute or use the latest features, install from source:

```bash
git clone https://github.com/traceroot-ai/traceroot-sdk-ts.git
cd src
npm install
npm run build
npm run format
npm run lint --fix
```
